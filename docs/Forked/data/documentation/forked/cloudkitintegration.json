{"kind":"article","seeAlsoSections":[{"generated":true,"anchor":"Articles","title":"Articles","identifiers":["doc:\/\/Forked\/documentation\/Forked\/GettingStarted","doc:\/\/Forked\/documentation\/Forked\/ForkedInnards"]}],"metadata":{"roleHeading":"Article","modules":[{"name":"Forked"}],"title":"CloudKit Integration Guide","role":"article"},"hierarchy":{"paths":[["doc:\/\/Forked\/documentation\/Forked"]]},"abstract":[{"type":"text","text":"Learn how to use ForkedCloudKit to sync your data across devices."}],"schemaVersion":{"minor":3,"patch":0,"major":0},"sections":[],"primaryContentSections":[{"content":[{"anchor":"Overview","level":2,"type":"heading","text":"Overview"},{"inlineContent":[{"text":"ForkedCloudKit makes it easy to sync your Forked data between devices using Apple’s CloudKit framework. This guide will walk you through the basic setup and usage.","type":"text"}],"type":"paragraph"},{"anchor":"Getting-Started","level":2,"text":"Getting Started","type":"heading"},{"inlineContent":[{"type":"text","text":"First, make sure you have the ForkedCloudKit subpackage added to your project dependencies."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Then import ForkedCloudKit in your source files:"}]},{"code":["import Forked","import ForkedCloudKit"],"type":"codeListing","syntax":"swift"},{"anchor":"Basic-Setup","level":2,"type":"heading","text":"Basic Setup"},{"inlineContent":[{"type":"text","text":"The main class you’ll work with is "},{"type":"codeVoice","code":"CloudKitExchange"},{"type":"text","text":". Here’s how to set it up:"}],"type":"paragraph"},{"code":["\/\/ Create a ForkedResource for your data","let repo = try AtomicRepository(managedFileURL: fileURL)","let forkedResource = try ForkedResource(repository: repo)","","\/\/ Create CloudKitExchange instance","let cloudKitExchange = try CloudKitExchange(","    id: \"<Unique ID for the repo in CloudKit>\",","    forkedResource: forkedResource",")"],"syntax":"swift","type":"codeListing"},{"inlineContent":[{"type":"text","text":"The "},{"code":"id","type":"codeVoice"},{"text":" parameter should be a unique string that identifies this resource in CloudKit.","type":"text"}],"type":"paragraph"},{"type":"heading","level":2,"text":"How It Works","anchor":"How-It-Works"},{"type":"paragraph","inlineContent":[{"type":"text","text":"CloudKitExchange automatically:"}]},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Monitors changes to your ForkedResource’s main fork"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Uploads changes to iCloud when detected"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Downloads changes from other devices"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Merges remote changes into your local data on the main fork"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"All of this happens in the background without blocking your app’s UI."}]},{"level":2,"type":"heading","anchor":"Example-Implementation","text":"Example Implementation"},{"type":"paragraph","inlineContent":[{"text":"Here’s a complete example showing how to integrate CloudKit sync into a SwiftUI app:","type":"text"}]},{"code":["@MainActor","class Store {","    private let repo: AtomicRepository<MyData>","    private let forkedResource: ForkedResource<AtomicRepository<MyData>>","    private let cloudKitExchange: CloudKitExchange<AtomicRepository<MyData>>","    ","    init() throws {","        \/\/ Setup local storage","        let fileURL = \/\/ ... your file URL","        repo = try AtomicRepository(managedFileURL: fileURL)","        forkedResource = try ForkedResource(repository: repo)","        ","        \/\/ Initialize CloudKit sync","        cloudKitExchange = try CloudKitExchange(","            id: \"<Unique ID for the repo in CloudKit>\",","            forkedResource: forkedResource","        )","    }","}"],"syntax":"swift","type":"codeListing"},{"type":"heading","anchor":"CloudKit-Setup-in-Xcode","level":2,"text":"CloudKit Setup in Xcode"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Before your app can use CloudKit:"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Enable iCloud in your Xcode target’s capabilities tab"}]}]},{"content":[{"inlineContent":[{"text":"Choose or add a container (","type":"text"},{"inlineContent":[{"type":"text","text":"eg"}],"type":"emphasis"},{"text":" “iCloud.com.mycompany.myapp”). The container ID should match the ","type":"text"},{"type":"codeVoice","code":"id"},{"text":" parameter in your ","type":"text"},{"type":"codeVoice","code":"CloudKitExchange"},{"text":" initializer.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Also enable the background modes for remote notifications and background processing"}]}]}],"type":"orderedList"},{"text":"Advanced Usage","anchor":"Advanced-Usage","level":2,"type":"heading"},{"text":"Custom Container","level":3,"anchor":"Custom-Container","type":"heading"},{"inlineContent":[{"type":"text","text":"By default, CloudKitExchange uses the default CloudKit container. You can specify a custom container:"}],"type":"paragraph"},{"syntax":"swift","code":["let container = CKContainer(identifier: \"iCloud.com.mycompany.myapp-another-container\")","let cloudKitExchange = try CloudKitExchange(","    id: \"<Unique ID for the repo in CloudKit>\",","    forkedResource: forkedResource,","    cloudKitContainer: container",")"],"type":"codeListing"},{"text":"Monitoring Sync Updates","level":3,"type":"heading","anchor":"Monitoring-Sync-Updates"},{"inlineContent":[{"type":"text","text":"CloudKitExchange automatically handles sync in the background, but you can monitor when changes from CloudKit are merged into your main fork."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"To do this, add a "},{"code":"Task","type":"codeVoice"},{"text":" on launch that monitors the ","type":"text"},{"type":"codeVoice","code":"changeStream"},{"type":"text","text":" for changes from CloudKit:"}]},{"type":"codeListing","syntax":"swift","code":["Task {","    for await change in forkedResource.changeStream ","        where change.fork == .main && change.mergingFork == .cloudKit {","        \/\/ Handle changes merged from CloudKit into main fork","    }","}"]},{"type":"heading","anchor":"Troubleshooting","level":2,"text":"Troubleshooting"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Common issues and solutions:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"No Sync"}],"type":"strong"},{"type":"text","text":": Ensure iCloud is enabled on the device, the user is signed in, and iCloud Drive enabled"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Data Not Appearing"}]},{"type":"text","text":": Check that your CloudKit container is properly configured"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Conflicts"}]},{"text":": ForkedCloudKit automatically handles conflicts using your resource’s merge strategy","type":"text"}]}]}]},{"text":"Further Reading","anchor":"Further-Reading","level":2,"type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/cloudkit"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/github.com\/drewmccormack\/Forked","isActive":true,"type":"reference"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Sample App: "},{"isActive":true,"type":"reference","identifier":"https:\/\/github.com\/drewmccormack\/Forked\/tree\/main\/Samples\/Forking%20Simple%20iCloud"}],"type":"paragraph"}]}],"type":"unorderedList"}],"kind":"content"}],"variants":[{"paths":["\/documentation\/forked\/cloudkitintegration"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Forked\/documentation\/Forked\/CloudKitIntegration"},"references":{"doc://Forked/documentation/Forked":{"url":"\/documentation\/forked","kind":"symbol","abstract":[{"type":"text","text":"A framework for handling shared data with confidence in Swift."}],"type":"topic","title":"Forked","role":"collection","identifier":"doc:\/\/Forked\/documentation\/Forked"},"doc://Forked/documentation/Forked/GettingStarted":{"identifier":"doc:\/\/Forked\/documentation\/Forked\/GettingStarted","url":"\/documentation\/forked\/gettingstarted","kind":"article","title":"Getting Started with Forked","role":"article","abstract":[{"text":"Learn how to use Forked to manage shared data in your Swift applications.","type":"text"}],"type":"topic"},"https://github.com/drewmccormack/Forked/tree/main/Samples/Forking%20Simple%20iCloud":{"url":"https:\/\/github.com\/drewmccormack\/Forked\/tree\/main\/Samples\/Forking%20Simple%20iCloud","identifier":"https:\/\/github.com\/drewmccormack\/Forked\/tree\/main\/Samples\/Forking%20Simple%20iCloud","titleInlineContent":[{"text":"Forking Simple iCloud","type":"text"}],"title":"Forking Simple iCloud","type":"link"},"doc://Forked/documentation/Forked/ForkedInnards":{"url":"\/documentation\/forked\/forkedinnards","type":"topic","kind":"article","identifier":"doc:\/\/Forked\/documentation\/Forked\/ForkedInnards","abstract":[{"text":"Forked is built around a simple yet powerful concept: data conflicts should be treated as a natural part of software systems rather than an exceptional state.","type":"text"}],"title":"Forked Innards: Understanding the Architecture","role":"article"},"https://github.com/drewmccormack/Forked":{"url":"https:\/\/github.com\/drewmccormack\/Forked","identifier":"https:\/\/github.com\/drewmccormack\/Forked","titleInlineContent":[{"type":"text","text":"Forked Documentation"}],"title":"Forked Documentation","type":"link"},"https://developer.apple.com/documentation/cloudkit":{"url":"https:\/\/developer.apple.com\/documentation\/cloudkit","identifier":"https:\/\/developer.apple.com\/documentation\/cloudkit","titleInlineContent":[{"text":"CloudKit Documentation","type":"text"}],"title":"CloudKit Documentation","type":"link"}}}